# Railway Project Configuration
# Este arquivo configura todos os serviços automaticamente

[build]
builder = "DOCKERFILE"
dockerfilePath = "backend/Dockerfile"

[deploy]
startCommand = "sh /app/deploy/start-production.sh"
healthcheckPath = "/api/health/"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 5

# Configuração automática de serviços
[[services]]
name = "backend"
type = "web"

[[services]]
name = "postgres"
type = "database"
plugin = "postgresql@16"

[[services]]
name = "redis"
type = "database"  
plugin = "redis@7"

# Variáveis de ambiente com referências automáticas
[environments.production]
DATABASE_URL = "${{postgres.DATABASE_URL}}"
REDIS_URL = "${{redis.REDIS_URL}}"
CELERY_BROKER_URL = "${{redis.REDIS_URL}}"
CELERY_RESULT_BACKEND = "${{redis.REDIS_URL}}"

# Variáveis fixas
DJANGO_SECRET_KEY = "M6OPViuKJiY7M9CXIW3A4VLlivK84_mQe8jzF-82haWW3mpwdIQfbf4vMCmz74DF6Zs"
DJANGO_ENV = "production"
DEBUG = "False"
ALLOWED_HOSTS = "${{RAILWAY_PUBLIC_DOMAIN}},*.railway.app"

# URLs
BACKEND_URL = "https://${{RAILWAY_PUBLIC_DOMAIN}}"
FRONTEND_URL = "https://finance-frontend-production-24be.up.railway.app"
CORS_ALLOWED_ORIGINS = "https://finance-frontend-production-24be.up.railway.app,https://caixahub.com.br"

# Email
EMAIL_BACKEND = "apps.core.email.ResendEmailBackend"
RESEND_API_KEY = "re_YDXSBoYK_JiExfayTWwV3kQjvb2PQTEzk"
DEFAULT_FROM_EMAIL = "noreply@caixahub.com.br"
SUPPORT_EMAIL = "suporte@caixahub.com.br"

# OpenAI
OPENAI_API_KEY = "CONFIGURE_IN_RAILWAY_DASHBOARD"

# Pluggy
PLUGGY_CLIENT_ID = "d3e002cb-d4bf-4467-be0a-959587433133"
PLUGGY_CLIENT_SECRET = "2b7e076f-e6ba-4112-8c15-fe319bc71bb1"
PLUGGY_BASE_URL = "https://api.pluggy.ai"
PLUGGY_CONNECT_URL = "https://connect.pluggy.ai"
PLUGGY_USE_SANDBOX = "False"
PLUGGY_WEBHOOK_URL = "https://${{RAILWAY_PUBLIC_DOMAIN}}/api/banking/webhooks/pluggy/"

# Stripe
STRIPE_PUBLIC_KEY = "CONFIGURE_IN_RAILWAY_DASHBOARD"
STRIPE_SECRET_KEY = "CONFIGURE_IN_RAILWAY_DASHBOARD"
STRIPE_WEBHOOK_SECRET = "CONFIGURE_IN_RAILWAY_DASHBOARD"

# MercadoPago
MERCADOPAGO_PUBLIC_KEY = "TEST-a325b2a3-ea53-4eca-ac80-1e6caabfff8a"
MERCADOPAGO_ACCESS_TOKEN = "TEST-2482130832602028-070923-2873fd649131c1c211c233ae7300288d-264321954"

# Payment
DEFAULT_PAYMENT_GATEWAY = "stripe"
TRIAL_PERIOD_DAYS = "14"
ENABLE_AUTO_RENEWAL = "true"
PAYMENT_RETRY_ATTEMPTS = "3"
PAYMENT_RETRY_INTERVAL_HOURS = "24"
SEND_PAYMENT_RECEIPTS = "true"
SEND_TRIAL_EXPIRATION_WARNINGS = "true"
TRIAL_WARNING_DAYS = "3,7"
DEFAULT_CURRENCY = "BRL"
APPLY_TAX = "false"
TAX_RATE = "0.0"

# Security
SECURE_SSL_REDIRECT = "True"
SESSION_COOKIE_SECURE = "True"
CSRF_COOKIE_SECURE = "True"

# App
SITE_NAME = "CaixaHub"
LANGUAGE_CODE = "pt-br"
TIME_ZONE = "America/Sao_Paulo"

# JWT
JWT_SECRET_KEY = "toG5JSfpnVDFDE9tm4oVb_na-lZrTXdG8CG8Mb6KkTQZmu6bFLAcMlrBQJU2c9uQ"
AI_INSIGHTS_ENCRYPTION_KEY = "sH1VupTcZcDlV_D4QIgD902nniuG5NuYF2CzHpFO2VU="

# Celery
CELERY_ACCEPT_CONTENT = "['json']"
CELERY_TASK_SERIALIZER = "json"
CELERY_RESULT_SERIALIZER = "json"
CELERY_TIMEZONE = "America/Sao_Paulo"
CELERY_WORKER_CONCURRENCY = "4"
CELERY_WORKER_PREFETCH = "1"